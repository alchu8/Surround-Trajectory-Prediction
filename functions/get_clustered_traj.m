function result = get_clustered_traj(trajectory_type, W_all, k)
% return cell structure of clustered trajectories
% trajectory_type is generated by trajectoryByType.m
% W_all is generated by SimGraph_Full.m or can be found in 'mat' folder
% k is array of cluster numbers, i.e. [2,4,3,6,4,7,2,7] for 2 clusters in
% type 1, 4 clusters in type 2......
    result = cell(8, 1);
    for veh_type = 1:8
        traj_now = trajectory_type{veh_type};
        W_now = W_all{veh_type};
        [~, member_hard, membership_value] = SpectralClustering(W_now, k(veh_type), 3);
        cell_out = Cluster2Cell(member_hard, membership_value, 0.8);
        traj_cluster = cell(length(unique(member_hard)), 1);
        for cNum = 1:size(traj_cluster, 1)
            traj_temp = cell(length(cell_out{cNum}), 1);
            for n = 1:length(cell_out{cNum})
                traj_temp{n} = traj_now{cell_out{cNum, 1}(n), 1};
            end
            traj_cluster{cNum} = traj_temp; 
        end
        result{veh_type} = traj_cluster;
    end
end